<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!--Generate PDF-->
  <script  src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"  integrity="sha256-vIL0pZJsOKSz76KKVCyLxzkOT00vXs+Qz4fYRVMoDhw=" 
  crossorigin="anonymous"> </script>
<!--End Generate PDF-->
    <!--Generate DOC-->
     <!--End Generate DOC-->

  <style>
      .navbar {
    min-height: 80px;
    }
    .offset-at-header{
    height: 80px;
    line-height: 80px;
    }

    .navbar-brand {
    padding: 10px;
    height: 80px;
    line-height: 80px;
    }

    .navbar-toggle {
    /* (80px - button height 34px) / 2 = 23px */
    margin-top: 23px;
    padding: 9px 10px !important;
    }

    @media (min-width: 768px) {
    .navbar-nav > li > a {
        /* (80px - line-height of 27px) / 2 = 26.5px */
        padding-top: 26.5px;
        padding-bottom: 26.5px;
        line-height: 27px;
    }

    .offset-at-header{
    min-height: 27px;
    }    
    }
    #textBox { 
        height:350px; 
        min-height:350px;  
        max-height:350px;
        resize: none;
    }
    #summaryBox {
        height:360px; 
        min-height:360px;  
        max-height:360px;
        resize: none;
    }
    footer{
        clear: both;
        position: relative;
        text-align: center;
        padding-top: 4em;
        z-index: 10;
        height: 3em;
        margin-top: -1em;
    }    
  </style>

<!-- image upload -->

<style>
        .inputfile {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }
        .inputfile + label {
            max-width: 80%;
            font-size: 18px;
            font-weight: 700;
             color: #000000;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
            display: inline-block;
            overflow: hidden;
            padding: 10px 20px;
        }
        .inputfile + label svg {
            vertical-align: middle;
            margin-right: 5px;
            width: 100%;
            height: 100%;
            fill: #0099CC;
        }
        .inputfile + label figure {
            width: 75px;
            height: 75px;
            border-radius: 50%;
            display: block;
            padding: 5px;
        }
        </style>
        
        <!-- image upload -->

</head>
<body>

<div id="navigation_div">
    <nav class="navbar navbar-default navbar-fixed-top bg-info">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#"><img src="logo.png" height="90%"></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse" aria-expanded="false" style="height: 1px;">
        <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
        </div><!--/.nav-collapse -->
    </div>
    </nav>
</div>

<div class="offset-at-header"></div>

<div class="container">
    <div class="row">
    
        <div  class="col-sm-5 " style="margin:2%;">
            <div class="form-group">
                <h3>Copy & Paste your text here..</h3>
                <textarea class="form-control" id="textBox"></textarea>
            </div>
        </div>
    
        <div class="col-sm-5 " style="margin:2%;"> 
            
            <h3>Or Choose file for summarization </h3>
    
                <!-- Image upload -->
                <form id="file_form"  method="post" enctype="multipart/form-data">
                    <input type="file" name="file" id="file" hidden="hidden" class="inputfile"/>
                    <label for="realFile" style="width:100%;display: table;">
                        <div style="float:left;margin-right: 10px;display: table-cell;vertical-align: middle;">
                            <figure id="customBtn">
                                <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                width="548.176px" height="548.176px" viewBox="0 0 548.176 548.176" style="enable-background:new 0 0 548.176 548.176;"
                                xml:space="preserve">
                                    <g>
                                        <path d="M524.326,297.352c-15.896-19.89-36.21-32.782-60.959-38.684c7.81-11.8,11.704-24.934,11.704-39.399
                                            c0-20.177-7.139-37.401-21.409-51.678c-14.273-14.272-31.498-21.411-51.675-21.411c-18.083,0-33.879,5.901-47.39,17.703
                                            c-11.225-27.41-29.171-49.393-53.817-65.95c-24.646-16.562-51.818-24.842-81.514-24.842c-40.349,0-74.802,14.279-103.353,42.83
                                            c-28.553,28.544-42.825,62.999-42.825,103.351c0,2.474,0.191,6.567,0.571,12.275c-22.459,10.469-40.349,26.171-53.676,47.106
                                            C6.661,299.594,0,322.43,0,347.179c0,35.214,12.517,65.329,37.544,90.358c25.028,25.037,55.15,37.548,90.362,37.548h310.636
                                            c30.259,0,56.096-10.711,77.512-32.12c21.413-21.409,32.121-47.246,32.121-77.516C548.172,339.944,540.223,317.248,524.326,297.352
                                            z M362.729,289.648c-1.813,1.804-3.949,2.707-6.42,2.707h-63.953v100.502c0,2.471-0.903,4.613-2.711,6.42
                                            c-1.813,1.813-3.949,2.711-6.42,2.711h-54.826c-2.474,0-4.615-0.897-6.423-2.711c-1.804-1.807-2.712-3.949-2.712-6.42V292.355
                                            H155.31c-2.662,0-4.853-0.855-6.563-2.563c-1.713-1.714-2.568-3.904-2.568-6.566c0-2.286,0.95-4.572,2.852-6.855l100.213-100.21
                                            c1.713-1.714,3.903-2.57,6.567-2.57c2.666,0,4.856,0.856,6.567,2.57l100.499,100.495c1.714,1.712,2.562,3.901,2.562,6.571
                                            C365.438,285.696,364.535,287.845,362.729,289.648z"/>
                                    </g>
                                </svg>
                                
                                <!--
                                    SVG
                                    <div>Icons made by <a href="https://www.flaticon.com/authors/dave-gandy" title="Cloud storage uploading option">Cloud storage uploading option</a> from <a href="https://www.flaticon.com/"     title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/"     title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
                                    -->
                            </figure>
                            <span class="badge" id="custom-text">No file Chosen</span>
                        </div>  
                        <div style="margin: 10px; display: table-cell;vertical-align: middle;">
                            <button disabled class="btn btn-info btn-md" type="submit" id="upload_file" name="upload_file">Upload file</button>
                        </div>      
                    </label>
                </form>
                    <span class="text-danger">*Valid formats are doc,docx,pdf,txt </span><br/>
                    <span class="text-danger">*Max file size allowed is 10MB </span>

                    <h3 style="margin-top:5%;">Select word limit for your summary ...</h3>
                    <div class="dropdown">
                        <select class="btn btn-default dropdown-toggle" type="button" id="menuSummaryLength" data-toggle="dropdown">
                            <option role="menuitem">1/3<sup>rd</sup> of document </option>
                            <option role="menuitem">1/4<sup>th</sup> of document</option>
                            <option role="menuitem">Random</option>
                        </select>
                    </div>
                      
                
                    <!-- Trigger the modal with a button -->
                        <div class="row" style="margin-top:5%;">
                            <div class="col-sm-offset-2 col-sm-4">
                                <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" id="summarize_btn">Summarize</button>
                            </div>
                        </div>


                    <!-- Modal -->
                    <div class="modal fade" id="myModal" role="dialog">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Your Summary</h4>
                            </div>
                            <div class="modal-body" style="background-color:white">
                                <div class="row" style="margin:10px;">
                                    <div class="col-sm-7" style="padding: 20px;height:400px;">
                                        <textarea class="form-control" style=" border: 1px solid black; border-radius: 10px;background-color: white" id="summaryBox"></textarea>
                                    </div>
                                    <div class="col-sm-5" style="padding: 50px;height:400px;">
                                        <h4 style="margin-top:10%;">Save summary as ...</h4>
                                        <div class="dropdown" style="margin-top:10%;">
                                            <select class="btn btn-default dropdown-toggle" type="button" id="menuFileType" data-toggle="dropdown">
                                                <option value="txt" selected role="menuitem">txt</option>
                                                <option value="pdf" role="menuitem">pdf</option>
                                                <option value="doc" role="menuitem">doc</option>
                                            </select>
                                        </div>
                                        <button type="button" style="margin-top:10%;width:100px;" class="btn btn-info" id="download_summary">Download</button>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
                            </div>
                            </div>
                        </div>
                    </div>
        </div>
    </div>
</div>

</body>
<footer>
    &copy;2018 Saaransh | Text Summarizer
</footer>
<!-- Image upload -->
    
<script>
    const realFileBtn=document.getElementById("file");
    const customFileBtn=document.getElementById("customBtn");
    const customText=document.getElementById("custom-text");
    customFileBtn.addEventListener("click",function(){
        realFileBtn.click();
    });
    realFileBtn.addEventListener("change",function(){
        if(realFileBtn.value)
        {
            customText.innerHTML=realFileBtn.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
        }
        else
        {
            customText.innerHTML="No file Chosen";
        }
    });
</script>

<script>
        $(document).ready(function(e){
            $("#file_form").on('submit', function(e){
                e.preventDefault();
                $.ajax({
                    type: 'POST',
                    url: 'fileUpload.php',
                    data: new FormData(this),
                    contentType: false,
                    cache: false,
                    processData:false,
                    success: function(msg){
                        if(msg!="error"){
                            console.log(msg);
                            alert("uploaded");
                        }else{
                            $('#file_form')[0].reset();
                            $("#custom-text").text('No file chosen');
                            console.log(msg);
                            alert("ERROR !!!");
                        }
                        $('#file_form').css("opacity","");
                    },
                    error:function(err){
                        $('#file_form')[0].reset();
                        $("#custom-text").text('No file chosen');
                        console.log("AJAX error in request: " + JSON.stringify(err, null, 2));
                        alert(err.toString());
                        var btn = document.getElementById("upload_file"); 
                        btn.disabled = true;
                    },
                });
            });

            //file type validation
            $("#file").change(function() {
                var file = this.files[0];
                var imagefile = file.type;
                var fileSize = parseFloat(file.size / (1024*1024)).toFixed(2);
                var match= ["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"];
                if(!((imagefile==match[0]) || (imagefile==match[1]) || (imagefile==match[2]) || (imagefile==match[3]))){
                    alert('Please select a valid file format');
                    $("#file").val('');
                    $("#custom-text").text('No file chosen');
                    return false;
                }
                if(fileSize>10){
                    alert('Please select a valid file within 10MB');
                    $("#file").val('');
                    $("#custom-text").text('No file chosen');
                    return false;
                }
                var btn = document.getElementById("upload_file"); 
                btn.disabled = false;
            });

            //modal text display
            $("#summarize_btn").click(function(){
                var input_text=$("#textBox").val().toString();
                $("#summaryBox").text(input_text+"");
            });

            document.getElementById("download_summary").onclick = function() {
                // when clicked the button
                var content = document.getElementById('summaryBox').value;
                
                var documentType=document.getElementById('menuFileType');
                var v=documentType.options[documentType.selectedIndex].value;
                
                switch(v)
                {
                    case 'txt' : download("summary.txt",content.toString(),'text/plain');
                                break;
                    case 'pdf' : printPDF(content.toString());
                                break;
                    case 'doc' : Export2Doc(content.toString());
                                break;
                   //default : download("summary.txt",content.toString(),'text/plain');
                }
            }

            function download(filename, text , documentType) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:'+documentType+';charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();
            document.body.removeChild(element);
            }


            function printPDF(text) {
                // @param 1 - Coordinate (in units declared at inception of PDF document) against left edge of the page
                // @param 2 - Coordinate (in units declared at inception of PDF document) against upper edge of the page
                // @param 3 - String or array of strings to be added to the page. Each line is shifted one line down per font, spacing settings declared before this call.
                const pdf = new jsPDF();
                pdf.text(20, 20, text);
                // save the PDF document (downloadable)
                pdf.save("Summary.pdf");
            }
            
            function Export2Doc(text){
                var preHtml = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>";
                var postHtml = "</body></html>";
                var html = preHtml+text+postHtml;

                var blob = new Blob(['\ufeff', html], {
                    type: 'application/msword'
                });
                
                // Specify link url
                var url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);
                
                // Specify file name
                filename = 'summary.doc';
                
                // Create download link element
                var downloadLink = document.createElement("a");

                document.body.appendChild(downloadLink);
                
                if(navigator.msSaveOrOpenBlob ){
                    navigator.msSaveOrOpenBlob(blob, filename);
                }else{
                    // Create a link to the file
                    downloadLink.href = url;
                    
                    // Setting the file name
                    downloadLink.download = filename;
                    
                    //triggering the function
                    downloadLink.click();
                }
                document.body.removeChild(downloadLink);
            }

        });

        </script>

</html>